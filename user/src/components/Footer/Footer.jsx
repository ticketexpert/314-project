import React, { useState, useEffect } from 'react';
import { Box, Typography, Grid, Select, MenuItem, Link as MuiLink } from '@mui/material';
import { currencies } from './footerData';
import { Link } from 'react-router-dom';
import { Stack } from '@mui/material';

export default function Footer() {
  const [currency, setCurrency] = useState('AUD');
  const [categories, setCategories] = useState([]);
  const [popularEvents, setPopularEvents] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchData = async () => {
      try {
        const response = await fetch('https://api.ticketexpert.me/api/events');
        if (!response.ok) {
          throw new Error('Failed to fetch events');
        }
        const data = await response.json();
        
        // Extract unique categories
        const uniqueCategories = [...new Set(data.map(event => event.category))];
        setCategories(uniqueCategories);

        // Get popular events (most recent 4 events)
        const sortedEvents = [...data].sort((a, b) => 
          new Date(b.fromDateTime) - new Date(a.fromDateTime)
        ).slice(0, 4);
        setPopularEvents(sortedEvents);
      } catch (error) {
        console.error('Error fetching footer data:', error);
      } finally {
        setLoading(false);
      }
    };

    fetchData();
  }, []);

  const footerSections = [
    {
      title: 'Categories',
      items: categories.map(category => ({
        label: category,
        href: `/events?category=${encodeURIComponent(category)}`
      }))
    },
    {
      title: 'Popular Events',
      items: popularEvents.map(event => ({
        label: event.title,
        href: `/event/${event.eventId}`
      }))
    },
    {
      title: 'Company',
      items: [
        { label: 'About Us', href: '/about' },
        { label: 'Contact', href: '/contact' },
        { label: 'Careers', href: '/careers' },
        { label: 'Blog', href: '/blog' }
      ]
    }
  ];

  return (
    <Box
      sx={{
        width: { xs: '100%', sm: '100vw' },
        mt: 6,
        px: 6,
        py: 4,
        background: 'linear-gradient(to bottom, #ffffff, #fceef0)',
        color: 'black',
      }}
    >
      <Grid container spacing={4} justifyContent="space-between">
        <Grid item xs={12} md={4}>
        <svg xmlns="http://www.w3.org/2000/svg" width="99" height="49" viewBox="0 0 99 49" fill="none">
            <g clip-path="url(#clip0_227_468)">
                <path d="M6.13299 5.85037H9.81339V9.06872H6.13299V14.5683C6.13299 15.5626 6.28809 16.3093 6.6003 16.8064C6.9115 17.3035 7.41783 17.5521 8.11929 17.5521C8.39146 17.5521 8.73269 17.499 9.14195 17.3917C9.55122 17.2845 10.0956 17.0359 10.777 16.646L11.2443 19.9225C10.5629 20.3515 9.87143 20.6492 9.17097 20.8146C8.47051 20.9799 7.78807 21.0631 7.12664 21.0631C5.3745 21.0631 4.08966 20.58 3.27113 19.6148C2.4536 18.6496 2.04433 17.2695 2.04433 15.4754V9.06872H0V5.85037H2.04433L3.21309 0.701599H6.13399V5.85037H6.13299Z" fill="#BF0426"/>
                <path d="M13.9312 2.28222C13.9312 1.6588 14.1543 1.12257 14.6026 0.673544C15.0499 0.22552 15.5852 0.00100708 16.2086 0.00100708C16.832 0.00100708 17.3664 0.22552 17.8147 0.673544C18.262 1.12257 18.4861 1.6588 18.4861 2.28222C18.4861 2.90565 18.262 3.44287 17.8147 3.8909C17.3664 4.33992 16.831 4.56344 16.2086 4.56344C15.5862 4.56344 15.0499 4.33992 14.6026 3.8909C14.1543 3.44287 13.9312 2.90665 13.9312 2.28222ZM14.1643 5.85038H18.253V20.4768H14.1643V5.85038Z" fill="#BF0426"/>
                <path d="M24.9712 13.106C24.9712 13.8276 25.0783 14.4811 25.2924 15.0664C25.5066 15.6518 25.7988 16.1489 26.169 16.5588C26.5382 16.9688 26.9815 17.2855 27.4979 17.51C28.0132 17.7345 28.5736 17.8468 29.177 17.8468C29.5862 17.8468 29.9845 17.7937 30.3747 17.6854C30.764 17.5782 31.1142 17.4218 31.4264 17.2174C31.7376 17.0129 31.9858 16.7543 32.1709 16.4416C32.356 16.1299 32.4581 15.769 32.4771 15.3591H36.7409C36.7409 16.2562 36.5658 17.061 36.2156 17.7726C35.8653 18.4853 35.364 19.0846 34.7116 19.5717C34.0591 20.0599 33.2656 20.4297 32.331 20.6833C31.3964 20.9369 30.3547 21.0631 29.206 21.0631C27.9982 21.0631 26.8845 20.8968 25.8618 20.566C24.8391 20.2342 23.9586 19.7371 23.2191 19.0736C22.4786 18.4111 21.9052 17.5822 21.496 16.5869C21.0867 15.5926 20.8826 14.432 20.8826 13.106C20.8826 11.7799 21.0817 10.6584 21.481 9.68313C21.8792 8.7079 22.4396 7.89404 23.1601 7.24055C23.8805 6.58706 24.7371 6.09493 25.7297 5.76317C26.7224 5.43141 27.8131 5.26604 29.0009 5.26604C30.1886 5.26604 31.2353 5.40736 32.1989 5.69001C33.1626 5.97265 33.9851 6.3876 34.6665 6.93285C35.348 7.47909 35.8683 8.14662 36.2296 8.93643C36.5898 9.72623 36.7699 10.6183 36.7699 11.6135H32.5061C32.4861 11.0483 32.3841 10.5702 32.1999 10.1803C32.0148 9.79038 31.7667 9.46864 31.4555 9.21506C31.1442 8.96148 30.788 8.77606 30.3898 8.65879C29.9905 8.54152 29.5672 8.48339 29.1189 8.48339C27.8721 8.48339 26.8705 8.90335 26.111 9.74127C25.3515 10.5802 24.9722 11.7017 24.9722 13.105L24.9712 13.106Z" fill="#BF0426"/>
                <path d="M39.4277 0H43.5164V11.2627L50.2628 5.85037H55.4612L49.007 11.2327L55.4322 20.4768H50.4379L45.8529 13.8657L43.5164 15.8262V20.4778H39.4277V0Z" fill="#BF0426"/>
                <path d="M71.6127 15.3581C71.6127 16.2551 71.4276 17.06 71.0583 17.7716C70.6881 18.4842 70.1627 19.0836 69.4813 19.5707C68.7999 20.0588 67.9863 20.4287 67.0427 20.6823C66.0981 20.9358 65.0614 21.0621 63.9327 21.0621C61.304 21.0621 59.2837 20.3896 57.8727 19.0435C56.4608 17.6974 55.7554 15.748 55.7554 13.1932C55.7554 10.6383 56.4518 8.70289 57.8437 7.32774C59.2356 5.9526 61.2459 5.26503 63.8747 5.26503C65.2566 5.26503 66.4643 5.46048 67.496 5.85037C68.5277 6.24026 69.3752 6.80655 70.0367 7.54725C70.6981 8.28894 71.1654 9.18098 71.4386 10.2244C71.7108 11.2678 71.7788 12.4525 71.6427 13.7785H59.843C59.9011 14.3247 60.0372 14.8459 60.2523 15.3431C60.4664 15.8402 60.7486 16.2742 61.0989 16.645C61.4491 17.0159 61.8724 17.3086 62.3697 17.523C62.866 17.7375 63.4164 17.8448 64.0198 17.8448C64.429 17.8448 64.8323 17.7917 65.2315 17.6834C65.6298 17.5762 65.981 17.4198 66.2832 17.2153C66.5844 17.0109 66.8336 16.7523 67.0277 16.4396C67.2218 16.1279 67.3289 15.767 67.3489 15.3571H71.6127V15.3581ZM67.2909 11.1455C67.1158 10.3076 66.7405 9.65306 66.1661 9.18499C65.5918 8.71692 64.8663 8.48238 63.9907 8.48238C63.1152 8.48238 62.2916 8.72694 61.6392 9.21406C60.9868 9.70217 60.4955 10.3456 60.1642 11.1445H67.2909V11.1455Z" fill="#BF0426"/>
                <path d="M79.0314 5.85037H82.7118V9.06872H79.0314V14.5683C79.0314 15.5626 79.1865 16.3093 79.4987 16.8064C79.8099 17.3035 80.3163 17.5521 81.0177 17.5521C81.2899 17.5521 81.6311 17.499 82.0404 17.3917C82.4497 17.2845 82.994 17.0359 83.6755 16.646L84.1428 19.9225C83.4613 20.3515 82.7699 20.6492 82.0694 20.8146C81.3689 20.9799 80.6865 21.0631 80.0251 21.0631C78.2729 21.0631 76.9881 20.58 76.1696 19.6148C75.352 18.6496 74.9428 17.2695 74.9428 15.4754V9.06872H72.8984V5.85037H74.9428L76.1105 0.701599H79.0314V5.85037Z" fill="#BF0426"/>
                <path d="M16.2975 37.2692C16.2975 38.1662 16.1124 38.9711 15.7431 39.6827C15.3729 40.3953 14.8476 40.9947 14.1661 41.4818C13.4847 41.9699 12.6711 42.3398 11.7275 42.5934C10.7829 42.8469 9.74624 42.9732 8.61751 42.9732C5.9888 42.9732 3.96848 42.3007 2.55756 40.9546C1.14564 39.6085 0.440186 37.6591 0.440186 35.1042C0.440186 32.5494 1.13664 30.614 2.52855 29.2388C3.92045 27.8637 5.93076 27.1761 8.55947 27.1761C9.94137 27.1761 11.1492 27.3716 12.1808 27.7615C13.2125 28.1513 14.0601 28.7176 14.7215 29.4583C15.3829 30.2 15.8502 31.0921 16.1234 32.1355C16.3956 33.1788 16.4636 34.3635 16.3275 35.6896H4.52685C4.58488 36.2358 4.72097 36.757 4.93611 37.2542C5.15025 37.7513 5.43244 38.1853 5.78266 38.5561C6.13289 38.927 6.55617 39.2196 7.05349 39.4341C7.54981 39.6486 8.10017 39.7559 8.70357 39.7559C9.11283 39.7559 9.51609 39.7027 9.91535 39.5945C10.3136 39.4873 10.6648 39.3309 10.967 39.1264C11.2682 38.922 11.5174 38.6634 11.7115 38.3507C11.9056 38.0389 12.0127 37.6781 12.0327 37.2682H16.2965L16.2975 37.2692ZM11.9747 33.0566C11.7996 32.2186 11.4243 31.5651 10.85 31.0961C10.2756 30.628 9.55012 30.3945 8.67455 30.3945C7.79898 30.3945 6.97544 30.638 6.32301 31.1261C5.67059 31.6143 5.17927 32.2577 4.84805 33.0566H11.9747Z" fill="#BF0426"/>
                <path d="M25.2634 37.4747L21.9923 42.3889H16.7058L22.6347 35.0752L16.7058 27.7615H21.9923L25.2634 32.6757L28.5345 27.7615H33.821L27.9211 35.0752L33.821 42.3889H28.5345L25.2634 37.4747Z" fill="#BF0426"/>
                <path d="M40.2462 27.7615V31.2133C40.2462 30.9407 40.3533 30.5749 40.5674 30.1158C40.7815 29.6578 41.1177 29.2088 41.575 28.7698C42.0323 28.3308 42.6067 27.9559 43.2982 27.6432C43.9886 27.3315 44.8122 27.1751 45.7658 27.1751C46.7194 27.1751 47.659 27.3605 48.5256 27.7314C49.3921 28.1022 50.1466 28.6284 50.789 29.311C51.4315 29.9936 51.9428 30.8224 52.322 31.7977C52.7013 32.7729 52.8914 33.8654 52.8914 35.0742C52.8914 36.2829 52.7013 37.3754 52.322 38.3507C51.9428 39.3259 51.4265 40.1548 50.774 40.8373C50.1216 41.5199 49.3521 42.0471 48.4665 42.4169C47.58 42.7868 46.6313 42.9722 45.6187 42.9722C44.6841 42.9722 43.8805 42.8359 43.2091 42.5623C42.5377 42.2897 41.9823 41.9679 41.544 41.5971C41.1057 41.2272 40.7795 40.8564 40.5654 40.4855C40.3512 40.1157 40.2442 39.832 40.2442 39.6376V48.999H36.1555V27.7604H40.2442L40.2462 27.7615ZM44.6851 39.6095C45.9119 39.6095 46.9045 39.2046 47.664 38.3958C48.4235 37.5869 48.8027 36.4794 48.8027 35.0752C48.8027 33.671 48.4325 32.5644 47.693 31.7546C46.9525 30.9457 46.0089 30.5408 44.8602 30.5408C44.4119 30.5408 43.9206 30.614 43.3852 30.7603C42.8499 30.9066 42.3485 31.1552 41.8812 31.506C41.4139 31.8568 41.0247 32.3249 40.7135 32.9102C40.4023 33.4956 40.2462 34.2172 40.2462 35.0752C40.2462 35.9331 40.3823 36.5916 40.6554 37.1669C40.9276 37.7423 41.2728 38.2103 41.6921 38.5712C42.1104 38.932 42.5827 39.1956 43.109 39.361C43.6344 39.5273 44.1607 39.6095 44.6861 39.6095H44.6851Z" fill="#BF0426"/>
                <path d="M71.0873 37.2692C71.0873 38.1662 70.9022 38.9711 70.5329 39.6827C70.1627 40.3953 69.6374 40.9947 68.9559 41.4818C68.2745 41.9699 67.4609 42.3398 66.5173 42.5934C65.5727 42.8469 64.536 42.9732 63.4073 42.9732C60.7786 42.9732 58.7583 42.3007 57.3474 40.9546C55.9354 39.6085 55.23 37.6591 55.23 35.1042C55.23 32.5494 55.9264 30.614 57.3183 29.2388C58.7102 27.8637 60.7206 27.1761 63.3493 27.1761C64.7312 27.1761 65.939 27.3716 66.9706 27.7615C68.0023 28.1513 68.8498 28.7176 69.5113 29.4583C70.1727 30.2 70.64 31.0921 70.9132 32.1355C71.1854 33.1788 71.2534 34.3635 71.1173 35.6896H59.3176C59.3757 36.2358 59.5118 36.757 59.7269 37.2542C59.941 37.7513 60.2232 38.1853 60.5735 38.5561C60.9237 38.927 61.347 39.2196 61.8443 39.4341C62.3406 39.6486 62.891 39.7559 63.4944 39.7559C63.9036 39.7559 64.3069 39.7027 64.7062 39.5945C65.1044 39.4873 65.4556 39.3309 65.7578 39.1264C66.059 38.922 66.3082 38.6634 66.5023 38.3507C66.6964 38.0389 66.8035 37.6781 66.8235 37.2682H71.0873V37.2692ZM66.7655 33.0566C66.5904 32.2186 66.2151 31.5651 65.6408 31.0961C65.0664 30.628 64.3409 30.3945 63.4653 30.3945C62.5898 30.3945 61.7662 30.638 61.1138 31.1261C60.4614 31.6143 59.9701 32.2577 59.6389 33.0566H66.7655Z" fill="#BF0426"/>
                <path d="M84.8142 31.6523C84.3859 31.2625 83.7135 31.067 82.7989 31.067C82.1565 31.067 81.5581 31.1452 81.0027 31.3005C80.4484 31.4569 79.9661 31.7205 79.5568 32.0904C79.1475 32.4612 78.8213 32.9483 78.5782 33.5527C78.334 34.1571 78.2129 34.9178 78.2129 35.8349V42.3879H74.1243V27.7605H78.2129V31.4759C78.2129 31.0861 78.369 30.642 78.6802 30.1449C78.9914 29.6478 79.4537 29.1847 80.0671 28.7557C80.6805 28.3267 81.454 27.98 82.3886 27.7174C83.3233 27.4548 84.404 27.3716 85.6308 27.4688L84.8132 31.6523H84.8142Z" fill="#BF0426"/>
                <path d="M93.5178 27.7615H97.1981V30.9798H93.5178V36.4794C93.5178 37.4737 93.6729 38.2204 93.9851 38.7175C94.2963 39.2146 94.8026 39.4632 95.504 39.4632C95.7762 39.4632 96.1174 39.4101 96.5267 39.3028C96.936 39.1956 97.4803 38.947 98.1618 38.5571L98.6291 41.8336C97.9476 42.2626 97.2562 42.5603 96.5557 42.7257C95.8553 42.891 95.1728 42.9742 94.5114 42.9742C92.7593 42.9742 91.4744 42.4911 90.6559 41.5259C89.8384 40.5607 89.4291 39.1806 89.4291 37.3865V30.9798H87.3848V27.7615H89.4291L90.5969 22.6127H93.5178V27.7615Z" fill="#BF0426"/>
            </g>
            <defs>
                <clipPath id="clip0_227_468">
                <rect width="98.6282" height="49" fill="white"/>
                </clipPath>
            </defs>
        </svg> <br/>
          <Typography sx={{ mt: 1, color: 'gray' }}>
            Effortless Events, Expertly Managed
          </Typography>
        </Grid>

        {/* Right side: Links */}
        <Grid item xs={12} md={8}>
          <Grid container spacing={4}>
            {footerSections.map((section, index) => (
              <Grid item xs={12} sm={6} md={4} key={index}>
                <Typography 
                  variant="h6" 
                  fontWeight="bold" 
                  gutterBottom
                  sx={{ color: '#9F1B32' }}
                >
                  {section.title}
                </Typography>
                <Stack spacing={1.5} mt={1}>
                  {section.items.map((item, idx) => (
                    <MuiLink
                      key={idx}
                      component={Link}
                      to={item.href}
                      sx={{
                        color: 'text.secondary',
                        fontSize: '0.875rem',
                        textDecoration: 'none',
                        '&:hover': {
                          color: '#9F1B32',
                          textDecoration: 'underline'
                        }
                      }}
                    >
                      {item.label}
                    </MuiLink>
                  ))}
                </Stack>
              </Grid>
            ))}
          </Grid>
        </Grid>
      </Grid>

      {/* Bottom row */}
      <Box
        sx={{
          mt: 6,
          display: 'flex',
          justifyContent: 'space-between',
          alignItems: 'center',
          flexWrap: 'wrap',
          borderTop: '1px solid #ddd',
          pt: 2,
        }}
      >
        <Typography fontSize={14} color="text.secondary">
          Â© {new Date().getFullYear()} TicketExpert. All rights reserved.
        </Typography>

        <Box sx={{ display: 'flex', alignItems: 'center', gap: 4 }}>
          {/* Currency dropdown */}
          <Select
            value={currency}
            onChange={(e) => setCurrency(e.target.value)}
            variant="standard"
            disableUnderline
            sx={{
              fontSize: 14,
              fontWeight: 500,
              minWidth: 80,
              '& .MuiSelect-select': {
                display: 'flex',
                alignItems: 'center',
              },
            }}
          >
            {currencies.map((curr) => (
              <MenuItem key={curr.code} value={curr.code}>
                {curr.label}
              </MenuItem>
            ))}
          </Select>

          <MuiLink
            component={Link}
            to="/terms"
            sx={{
              fontSize: 14,
              color: 'text.secondary',
              textDecoration: 'none',
              '&:hover': { color: '#9F1B32' }
            }}
          >
            Terms
          </MuiLink>
          <MuiLink
            component={Link}
            to="/policy"
            sx={{
              fontSize: 14,
              color: 'text.secondary',
              textDecoration: 'none',
              '&:hover': { color: '#9F1B32' }
            }}
          >
            Policy
          </MuiLink>
          <MuiLink
            component={Link}
            to="/privacy"
            sx={{
              fontSize: 14,
              color: 'text.secondary',
              textDecoration: 'none',
              '&:hover': { color: '#9F1B32' }
            }}
          >
            Privacy
          </MuiLink>
        </Box>
      </Box>
    </Box>
  );
}
